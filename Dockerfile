FROM archlinux/archlinux:latest
LABEL maintainer="noncetonic <noncetonic@blacksunhackers.club>"
ENV SHELL /bin/bash
ENV HOME /root
WORKDIR /root

# Configure pacman.conf
RUN echo "[multilib]" >> /etc/pacman.conf && \
	echo "Include = /etc/pacman.d/mirrorlist" >> /etc/pacman.conf

# Run strap.sh 
ADD strap.sh /root/
RUN chmod +x /root/strap.sh
RUN /root/strap.sh

RUN pacman -Syu --noconfirm git base-devel firefox firefox-adblock-plus flashplugin screen nload  \
	net-tools openssh aria2 leafpad htop man tigervnc lxde ttf-dejavu --noc --needed --ignore filesystem

# Run yay-setup.sh
ADD yay-setup.sh /root/
RUN chmod +x /root/yay-setup.sh
RUN /root/yay-setup.sh

RUN rm -rf /var/cache/pacman/pkg/*

RUN cp /etc/skel/.bashrc /root/ && \
	echo "alias blackarch='pacman -Sgg | sort -u | grep --color \"blackarch\"'" >> /root/.bashrc && \
	echo "alias pacman='pacman --noc'" >> /root/.bashrc

RUN mkdir /root/.vnc && \
	echo "startlxde" > /root/.vnc/xstartup && \
	echo "killall Xvnc 2> /dev/null" > /usr/bin/startx && \
	echo "rm -rf /tmp/.* 2> /dev/null" >> /usr/bin/startx && \	
	echo "vncserver :0  >> /usr/bin/startx"

# Clean up the install scripts
RUN rm -f /root/yay-setup.sh
RUN rm -rf /root/strap.sh

ADD README.md armitage-setup /root/
RUN chmod +x /root/armitage-setup /root/.vnc/xstartup /usr/bin/startx
EXPOSE 5900
CMD ["/bin/bash"]
